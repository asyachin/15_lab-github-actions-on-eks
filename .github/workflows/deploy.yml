# name: Deploy static site to EC2

# on:
#   push:
#     branches: [ "labs/dev" ]

# jobs:
#   deploy:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout repository
#         uses: actions/checkout@v4

#       - name: Prepare SSH
#         run: |
#           mkdir -p ~/.ssh
#           echo "${{ secrets.EC2_SSH_KEY }}" > ~/.ssh/id_rsa
#           chmod 600 ~/.ssh/id_rsa
#           ssh-keyscan -H "${{ secrets.EC2_HOST }}" >> ~/.ssh/known_hosts

#       - name: Copy files via SSH
#         uses: appleboy/scp-action@v1
#         with:
#           host: ${{ secrets.EC2_HOST }}
#           username: ${{ secrets.EC2_USER }}
#           key: ${{ secrets.EC2_SSH_KEY }}
#           source: "index.html,style.css,main.js"
#           target: /home/${{ secrets.EC2_USER }}/temp

#       - name: Execute remote SSH commands to copy from temp to real folder
#         uses: appleboy/ssh-action@v1
#         with:
#           host: ${{ secrets.EC2_HOST }}
#           username: ${{ secrets.EC2_USER }}
#           key: ${{ secrets.EC2_SSH_KEY }}
#           script: |

#             sudo mkdir -p /usr/site/
#             sudo rsync -av /home/${{ secrets.EC2_USER }}/temp/ /usr/site/
#             sudo chown -R www-data:www-data /usr/site/
#             sudo chmod -R 755 /usr/site/

#             sudo rm -f /etc/nginx/sites-enabled/default
#             sudo ln -sf /etc/nginx/sites-available/ec2-static /etc/nginx/sites-enabled/ec2-static

#             sudo nginx -t && sudo systemctl reload nginx
#             sudo rm -rf /home/${{ secrets.EC2_USER }}/temp